<DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8"/>
		<title>Wolfchamane.com [Test] getMovies</title>
		<style>
			.hide{display:none;}
			table tr th,
			table tr td{border:1px solid #ccc;}
		</style>
	</head>
	<body>
		<button id="getAll"><span>Get all movies</span></button>

		<!--button id="getAllByTitle"><span>Get all movies by title</span></button>
		<div id="getAllByTitleForm" class="hide"></div>

		<button id="getAllByYear"><span>Get all movies by year</span></button>
		<div id="getAllByYearForm" class="hide"></div>

		<button id="getAllByGenre"><span>Get all movies by genre</span></button>
		<div id="getAllByGenreForm" class="hide"></div>

		<button id="saveNewOne"><span>Get all movies</span></button>
		<div id="saveNewOneForm" class="hide"></div-->

		<div id="response">
			<table>
				<thead>
					<tr>
						<th>ID</th>
						<th>Title</th>
						<th>Genre</th>
						<th>Year</th>
						<th>Rating</th>
					</tr>
				</thead>
			</table>
		</div>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
		<script>
			if ($){

				function isValidJSON(data){
					var result = false;
					try{
						JSON.stringify(data);
						result = true;
					}catch(e){
						result = false;
					}
					return result;
				}

				function doRequest(url, params){

					var results = $('#response');

					var options = {
						url: encodeURI('../backend/' + url + '.php'),
						type: params ? 'POST' : 'GET',
						crossDomain: true,
						async: false,
						cache: false,
						context: this,
						dataType: 'json'
					};

					options.data = params ? params : null;

					var xhr = $.ajax(options);

					xhr.done(function(response, status, jqXhr){
						debugger;
						if (isValidJSON(response))
						{
							if (response.code === 'ok')
							{
								var tBody = '<tbody>';

								localStorage.setItem('testGetMovies', JSON.stringify(response.data));
								
								response.data.forEach(function(movie){
									var row = '<tr>';
									for (var property in movie){
										if (movie.hasOwnProperty(property)){
											row += '<td>' + movie[property] + '</td>';
										}
									}
									
									if (row.match(/.+(td).+/)){
										row += '</tr>';
										tBody += row;
									}else{
										row = null;
									}
								});

								if (tBody.match(/.+(tr).+/)){
									tBody += '</tbody>';
									results.find('table').append(tBody);
								}
							}

							if (response.code === 'error')
							{
								results.find('table').append('<tbody><tr><td colspan="5">' + response.error + '</td></tr></tbody>');
							}
						}
					}).fail(function(jqXhr, status, error){
						debugger;
					});
				}

				$(document).ready(function(){

					localStorage.removeItem('testGetMovies');

					$('button').unbind('click');
					$('#getAll').click(function(){
						doRequest('getMovies', null);
					});
				});
			}
		</script>
	</body>
</html>