<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width"/>
        <title>Test com.wolfchamane/core</title>
        <link rel="import" href="__VENDORS__polymer/polymer.html"/>
        <link rel="import" href="./components/login-form.html"/>
        <link rel="stylesheet" href="./core.css"/>
    </head>
    <body>

        <h1>Test com.wolfchamane/core + Polymer</h1>

        <hr/>

        <div id="web-content" class="animated animation-off"></div>

        <script src="./core.js"></script>
        <script src="__VENDORS__webcomponentsjs/webcomponents.min.js"></script>
        <script>
            Core.Router.init({
                base: '/core',
                rootNode: 'web-content',
                paths: [
                    {
                        path: '/',
                        template: function()
                        {
                            return '<login-form></login-form>';
                        }
                    },
                    {
                        path: 'global-position',
                        template: function(params)
                        {
                            debugger;
                            var tpl = '<h1>Global Position</h1><p>Welcome {{user}}!</p><p><a href="./">Index</a><br/><a href="./about">About</a></p>';
                            if (!Object.keys(params).length)
                            {
                                var user = localStorage.getItem('com-wolfchamane-core-model-users');
                                if (user)
                                {
                                    try
                                    {
                                        user = window.atob(user);
                                        user = JSON.parse(user);
                                        user = user.user;
                                    }
                                    catch(e)
                                    {
                                        user = null;
                                    }
                                }

                                if (user)
                                {
                                    params = {
                                        user: user.name
                                    };

                                }
                            }
                            if (params)
                            {
                                Object.keys(params).forEach(function(prop){
                                    tpl = tpl.replace('{{' + prop + '}}', params[prop]);
                                });
                            }
                            return tpl;
                        }
                    },
                    {
                        path: 'about',
                        template: function(){ return '<h1>About</h1><p><a href="./">Index</a><br/><a href="./globalPosition">Global Position</a></p>'; }
                    }
                ]
            });
        </script>
    </body>
</html>